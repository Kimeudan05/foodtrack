{% extends "base.html" %}
{% block content %}

<h3 class="fw-bold mb-4">Admin Dashboard</h3>

<div class="row text-center mb-4">
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h6>Total Users</h6>
            <h3>{{total_users}}</h3>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h6>Total Meals</h6>
            <h3>{{total_meals}}</h3>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h6>Total Spend</h6>
            <h3 class="text-success fw-bold">Ksh {{"%.2f"|format(total_spend)}}</h3>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <h6>Avg. Cost per meal</h6>
            <h3 class="text-success fw-bold">Ksh {{"%.2f"|format(avg_cost)}}</h3>
        </div>
    </div>
</div>
<div class="card p-4 mb-4 shadow-sm">
    <h5>Weekly Spending Trend</h5>
    <canvas id="adminChart"></canvas>
</div>

<div class="card p-3 shadow-sm">
    <h5 class="mb-3">User Summary</h5>
    <table class="table table-striped align-middle">
        <thead class="table-dark">
            <tr>
                <th>User</th>
                <th>Total Meals</th>
                <th>Total Cost (Ksh)</th>

            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td><a href="{{ url_for('admin.user_detail', user_id=user.id) }}"
                        class="text-decoration-none fw-semibold">
                        {{ user.username }}
                    </a></td>
                <td>{{ user.meal_count }}</td>
                <td>{{ "%.2f"|format(user.total_cost) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById("adminChart");
    new Chart(ctx, {
        type: "line",
        data: {
            labels: {{ labels| tojson }},
        datasets: [{
            label: "Total Spend (Ksh)",
            data: {{ values| tojson }},
        borderColor: "#0d6efd",
        backgroundColor: "rgba(13, 110, 253, 0.15)",
        fill: true,
        tension: 0.4,
    }]
  },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
});
</script>

{% endblock %}